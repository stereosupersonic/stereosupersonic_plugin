module FooPlugin
  module ActionView
    
    def incluce_google_webmastertools
      if APP_CONFIG[:google_webmastertools_key]
        %{
          <meta name="google-site-verification" content="#{APP_CONFIG[:google_webmastertools_key]}" />
         }
       end
    end  
    
    def include_google_analytics(domain=nil)
       if APP_CONFIG[:google_analytics_key]
         <<-EOF
           <script type="text/javascript">
             var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
             document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
           </script>

           <script type="text/javascript">
             try {
                   var pageTracker = _gat._getTracker("#{APP_CONFIG[:google_analytics_key]}");
                   pageTracker._trackPageview();
                   #{"pageTracker._setDomainName('#{domain}');" if domain}
                  } catch(err) {}
            </script>
         EOF
       end
     end
     
     def include_clicky
        if APP_CONFIG[:clicky_async_site_id]
          <<-EOF
            <script type="text/javascript">
              var clicky = { log: function(){ return; } };
              var async_site_id = #{APP_CONFIG[:clicky_async_site_id]};
              (function() {
                function clicky_load() {
                  var s = document.createElement('script');
                  s.type = 'text/javascript';
                  s.src = ( document.location.protocol == 'https:' ? 'https://static.getclicky.com' : 'http://static.getclicky.com' ) + '/js';
                  document.body.appendChild( s );
                }
                if( window.addEventListener ) window.addEventListener( 'load', clicky_load, false );
                else if( window.attachEvent ) window.attachEvent( 'onload', clicky_load );
                else clicky_load();
              })();
            </script>
          EOF
        end
      end
  end
end

ActionView::Base.send :include, FooPlugin::ActionView

